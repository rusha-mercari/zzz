# ZZZ Plugin

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)](#)
[![License](https://img.shields.io/badge/license-MIT-blue)](#)
[![Version](https://img.shields.io/badge/version-0.1.0-orange)](#)

A Zellij plugin that coordinates multiple AI assistants for collaborative software development workflows.

## Overview

The ZZZ plugin acts as a central coordinator in a Zellij layout, orchestrating communication between different AI assistants to create a seamless development workflow. It manages the complete development lifecycle from planning to implementation to review.

### Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    ZZZ Coordinator Plugin                   │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│   Overseer  │  Commander  │ Task List   │     Review      │
│  (OpenAI)   │   (Claude)  │   Viewer    │    Viewer       │
│             │             │             │                 │
│ • Planning  │ • Implementation │ • Todo tracking │ • Code review │
│ • Reviews   │ • Code writing   │ • Progress view │ • Feedback    │
└─────────────┴─────────────┴─────────────┴─────────────────┘
```

## Features

- **🤖 Multi-AI Coordination**: Seamlessly coordinates between OpenAI Codex and Claude Code
- **📋 Automated Planning**: Generates comprehensive todo lists using OpenAI Codex
- **⚡ Smart Execution**: Automatically executes commands in appropriate panes
- **📁 File Management**: Creates and manages `.zzz/task-{id}/` directory structure
- **🔄 Workflow States**: Manages progression through development phases
- **📊 Progress Tracking**: Real-time status monitoring and logging
- **🛡️ Error Handling**: Robust error recovery and validation

## Installation

### Prerequisites

- [Zellij](https://zellij.dev/) terminal workspace
- Rust toolchain with `wasm32-wasip1` target
- OpenAI API access (for Codex)
- Claude API access

### Build from Source

```bash
# Clone the repository
git clone <repository-url>
cd zzz

# Add the WASM target
rustup target add wasm32-wasip1

# Build the plugin
cargo build --target wasm32-wasip1 --release

# The plugin will be available at:
# target/wasm32-wasip1/release/zzz.wasm
```

## Configuration

### Zellij Layout Configuration

Create a layout file (e.g., `ai-dev.kdl`) with the ZZZ plugin:

```kdl
layout {
    pane size=1 borderless=true {
        plugin location="file:target/wasm32-wasip1/release/zzz.wasm" {
            task_id "123"
            task_description "Implement user authentication system"
            api_key "your-litellm-api-key"
            litellm_url "https://litellm.example.in"
        }
    }
    pane split_direction="vertical" {
        pane name="Overseer" {
            command "bash"
        }
        pane name="Commander" {
            command "bash"
        }
    }
    pane split_direction="horizontal" {
        pane name="Task List" {
            command "bash"
        }
        pane name="Review" {
            command "bash"
        }
    }
}
```

### Launch the Layout

```bash
zellij --layout ai-dev.kdl
```

## Usage

### Basic Workflow

1. **Initialization**: The plugin automatically detects panes and requests permissions
2. **Planning Phase**: Executes codex command in Overseer pane to generate todo list
3. **Implementation**: Monitors todo list completion and coordinates with Commander
4. **Review**: Triggers code review process when implementation is complete

### Generated File Structure

```
.zzz/
└── task-123/
    ├── todo-list.md      # Generated by Overseer (OpenAI Codex)
    ├── review.md         # Generated during review phase
    ├── plan.md           # Implementation planning
    └── logs/
        ├── overseer.log
        ├── commander.log
        └── coordinator.log
```

### Configuration Parameters

| Parameter          | Description                             | Default                      |
| ------------------ | --------------------------------------- | ---------------------------- |
| `task_id`          | Unique identifier for the task          | Required                     |
| `task_description` | Description of the feature to implement | Required                     |
| `api_key`          | LiteLLM API key                         | Required                     |
| `litellm_url`      | LiteLLM endpoint URL                    | `https://litellm.example.in` |

## Workflow Phases

The plugin manages eight distinct workflow phases:

1. **Initializing** → Setup and permission requests
2. **PlanningInProgress** → Codex generates todo list
3. **PlanReady** → Todo list available for implementation
4. **ImplementationInProgress** → Development in progress
5. **ImplementationComplete** → All tasks finished
6. **ReviewInProgress** → Code review phase
7. **ReviewComplete** → Review finished
8. **Finished** → Workflow complete

## API Integration

### OpenAI Codex Integration

The plugin uses the `codex` CLI with environment variables:

```bash
OPENAI_BASE_URL="https://litellm.example.in" \
OPENAI_API_KEY="your-key" \
codex --quiet "Generate todo list for: <task_description>"
```

### Pane Communication

- Uses Zellij's `write_chars_to_pane_id` API for direct command execution
- Implements role-based pane discovery and registration
- Supports both JSON message passing and raw command execution

### Running Tests

```bash
# Run all tests
cargo test

# Run specific test module
cargo test communication
```

### With the Provided Layout

Run `zellij -l zellij.kdl` at the root of this repository. This will open a development environment that will help you develop the plugin inside Zellij.

### Manual Development

1. Build the project: `cargo build --target wasm32-wasip1`
2. Load it inside a running Zellij session: `zellij action start-or-reload-plugin file:target/wasm32-wasip1/debug/zzz.wasm`
3. Repeat on changes (perhaps with a `watchexec` or similar command to run on fs changes)

## Troubleshooting

### Common Issues

1. **Permissions not granted**: Ensure Zellij allows `ReadApplicationState` and `WriteToStdin`
2. **Panes not discovered**: Check pane names match expected patterns (case-insensitive)
3. **API errors**: Verify LiteLLM configuration and API key validity
4. **File system errors**: Ensure write permissions for `.zzz` directory

### Debug Logging

Check the coordinator log for detailed execution information:

```bash
tail -f .zzz/task-123/logs/coordinator.log
```

## Implementation Status

### Completed ✅

- [x] Core infrastructure and state management
- [x] File system operations with comprehensive testing (50 tests)
- [x] Inter-pane communication system with dependency injection
- [x] Initialize → Planning state transition with codex CLI integration
- [x] Message routing by pane roles
- [x] Comprehensive error handling and logging

### In Progress 🚧

- [ ] Planning → Implementation transition with todo-list.md detection
- [ ] Implementation → Review transition with completion detection
- [ ] Review → Complete transition with review.md processing
- [ ] State persistence to survive plugin restarts

### Future Enhancements 🔮

- [ ] Support for additional AI providers
- [ ] Custom workflow definitions
- [ ] Performance metrics and analytics
- [ ] Multi-language project support
- [ ] Git integration and automation
- [ ] Collaborative multi-user workflows

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- [Zellij](https://zellij.dev/) for the excellent terminal workspace
- [OpenAI](https://openai.com/) for Codex API
- [Anthropic](https://anthropic.com/) for Claude API
- The Rust community for excellent tooling and libraries

---

For more detailed implementation information, see [plan.md](plan.md) and [tasks.md](tasks.md).
